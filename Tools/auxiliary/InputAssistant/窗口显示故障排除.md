# 窗口选择器显示问题故障排除指南

## 问题描述
点击"选择窗口"按钮后，窗口选择器对话框没有在前台显示，用户无法看到或操作选择器窗口。

## 已实施的解决方案

### 1. 窗口层级管理
- **TopMost属性**: 窗口选择器设置为最顶层显示
- **临时取消主窗口TopMost**: 避免主窗口阻挡选择器
- **强制前台显示**: 使用多种Windows API确保窗口在前面

### 2. 多重激活机制
- **SetForegroundWindow**: 强制设置前台窗口
- **SetWindowPos**: 使用HWND_TOPMOST确保在最顶层
- **ShowWindow**: 多次调用确保窗口可见
- **BringToFront + Activate**: .NET框架级别的激活

### 3. 视觉提示
- **窗口闪烁**: 使用FlashWindowEx API闪烁3次吸引注意
- **任务栏显示**: 确保在任务栏中可见
- **多重显示尝试**: 在多个事件中重复激活操作

## 用户故障排除步骤

### 步骤1: 基本检查
1. **检查任务栏**: 查看任务栏是否有"选择目标窗口"的窗口图标
2. **使用Alt+Tab**: 按Alt+Tab查看是否有窗口选择器在后台
3. **检查屏幕边缘**: 窗口可能显示在屏幕边缘或第二显示器上

### 步骤2: 使用测试功能
1. 点击主界面上的**"测试选择器"**按钮（黄色背景）
2. 观察是否能看到测试窗口
3. 如果测试窗口可见，说明显示功能正常

### 步骤3: 手动激活
如果窗口选择器在后台：
1. 点击任务栏中的窗口选择器图标
2. 或使用Alt+Tab切换到窗口选择器
3. 窗口应该会显示并闪烁

### 步骤4: 重启应用
如果以上步骤都无效：
1. 关闭Input Assistant
2. 重新启动应用程序
3. 再次尝试选择窗口功能

## 技术细节

### 实施的API调用
```cpp
// 窗口层级控制
SetWindowPos(hWnd, HWND_TOPMOST, 0, 0, 0, 0, SWP_NOMOVE | SWP_NOSIZE | SWP_SHOWWINDOW);

// 前台窗口设置
SetForegroundWindow(hWnd);

// 窗口显示状态
ShowWindow(hWnd, SW_RESTORE);
ShowWindow(hWnd, SW_SHOW);

// 窗口闪烁
FlashWindowEx(&flashInfo);
```

### .NET框架调用
```csharp
// 窗口属性设置
this.TopMost = true;
this.ShowInTaskbar = true;

// 窗口激活
this.Show();
this.BringToFront();
this.Activate();
this.Focus();
```

## 已知限制

### 系统限制
- **UAC限制**: 某些系统配置可能限制窗口前台显示
- **焦点窃取保护**: Windows 10/11的焦点窃取保护可能阻止窗口激活
- **多显示器**: 窗口可能显示在非主显示器上

### 应用程序限制
- **全屏应用**: 全屏游戏或应用可能阻挡对话框
- **管理员权限**: 以管理员身份运行的应用可能有不同的显示行为

## 替代解决方案

### 方案1: 非模态显示
如果模态对话框有问题，代码会自动尝试非模态显示方式。

### 方案2: 手动窗口管理
用户可以：
1. 最小化其他窗口
2. 使用Windows键+D显示桌面
3. 然后点击"选择窗口"按钮

### 方案3: 键盘导航
如果窗口选择器可见但无法点击：
1. 使用Tab键导航到窗口列表
2. 使用上下箭头键选择窗口
3. 按Enter键确认选择

## 调试信息

### 启用调试输出
应用程序会在调试输出中显示窗口状态信息：
- 窗口句柄
- 可见性状态
- TopMost属性状态

### 查看调试信息
在Visual Studio中运行时，可以在输出窗口查看调试信息。

## 反馈和改进

如果问题仍然存在，请记录以下信息：
1. **操作系统版本**: Windows 10/11具体版本
2. **显示器配置**: 单显示器/多显示器
3. **其他运行的应用**: 特别是全屏或置顶应用
4. **UAC设置**: 用户账户控制级别
5. **具体现象**: 窗口是否在任务栏显示、是否能通过Alt+Tab看到等

这些信息有助于进一步改进窗口显示机制。

## 总结

通过多重窗口激活机制、视觉提示和故障排除步骤，大多数窗口显示问题都能得到解决。如果仍有问题，可以使用测试功能进行诊断，或采用替代的操作方式。

# **Tokenå¾ªç¯é—®é¢˜ä¸“å®¶å’¨è¯¢æ‘˜è¦**

**æ—¥æœŸ**: 2025-06-29  
**çŠ¶æ€**: ğŸš¨ ç´§æ€¥ - éœ€è¦ä¸“å®¶æŒ‡å¯¼  
**é—®é¢˜**: ä¿®å¤å¼•å…¥æ–°é—®é¢˜ï¼Œé˜»å¡å›å½’æµ‹è¯•  

---

## **ğŸ¯ æ ¸å¿ƒé—®é¢˜**

åœ¨ä¿®å¤Whisperæ¨¡å‹æ–‡æœ¬tokené‡å¤å¾ªç¯åï¼Œå¼•å…¥äº†æ–°çš„æ—¶é—´æˆ³tokenå¾ªç¯é—®é¢˜ï¼š

- âœ… **Timestampæ¨¡å¼**: ä¿®å¤æˆåŠŸï¼Œæ€§èƒ½æå‡74å€ (28s â†’ 571ms)
- âŒ **No-timestampæ¨¡å¼**: é™·å…¥`[_TT_3]`æ—¶é—´æˆ³tokenæ— é™å¾ªç¯
- âŒ **å›å½’æµ‹è¯•**: æ— æ³•é€šè¿‡ï¼Œé˜»å¡åç»­å¼€å‘

---

## **ğŸ”§ æŠ€æœ¯å®ç°**

### **ä¿®å¤ç­–ç•¥**
```cpp
// 1. é‡å¤æƒ©ç½š (ä»…æ–‡æœ¬token)
if( token_id <= vocab.token_beg ) {
    modified_probs[token_id] /= repetition_penalty; // 1.5
}

// 2. å·®å¼‚åŒ–æ¸©åº¦é‡‡æ ·
float temperature = (i > vocab.token_beg) ? 1.2f : 0.8f;
modified_probs[i] = powf(modified_probs[i], 1.0f / temperature);
```

### **é—®é¢˜ç°è±¡**
```
DEBUG: token.id=50367 ('[_TT_3]'), vocab.token_beg=50365, token.p=0.000118
DEBUG: Timestamp token detected, seek_delta_new=4
DEBUG: Failure condition met - seek_delta=4 < threshold=1500
runFullImpl: too many consecutive timestamp failures, switching to no-timestamp mode
```

---

## **ğŸš¨ æ€¥éœ€ä¸“å®¶æŒ‡å¯¼çš„é—®é¢˜**

### **1. æ¶æ„ç†è§£**
- **No-timestampæ¨¡å¼ä¸‹æ˜¯å¦åº”è¯¥ç”Ÿæˆæ—¶é—´æˆ³tokenï¼Ÿ**
- **ä¸åŒæ¨¡å¼æ˜¯å¦éœ€è¦å®Œå…¨ä¸åŒçš„é‡‡æ ·ç­–ç•¥ï¼Ÿ**

### **2. æŠ€æœ¯æ–¹æ¡ˆ**
- **å½“å‰çš„é€‰æ‹©æ€§å¤„ç†æ–¹æ¡ˆæ˜¯å¦æ­£ç¡®ï¼Ÿ**
- **å¦‚ä½•å¹³è¡¡timestampå’Œno-timestampæ¨¡å¼çš„éœ€æ±‚ï¼Ÿ**

### **3. è°ƒè¯•æ–¹å‘**
- **`seek_delta < threshold`å¤±è´¥æ¡ä»¶çš„å«ä¹‰ï¼Ÿ**
- **æ¦‚ç‡åˆ†å¸ƒå¼‚å¸¸çš„æ ¹æœ¬åŸå› ï¼Ÿ**

---

## **ğŸ“Š è¯¦ç»†æ–‡æ¡£**

1. **å®Œæ•´ä¸“å®¶å’¨è¯¢**: `./Phase2_Token_Loop_Expert_Consultation.md`
2. **æŠ€æœ¯åˆ†ææŠ¥å‘Š**: `./Phase2_Token_Loop_Technical_Analysis.md`
3. **åŸå§‹é—®é¢˜è®°å½•**: `./Phase2_Round4_Expert_Consultation_Request.md`

---

## **â° æ—¶é—´æ•æ„Ÿæ€§**

- **é«˜ä¼˜å…ˆçº§**: é˜»å¡Phase2å›å½’æµ‹è¯•
- **å½±å“èŒƒå›´**: æ•´ä¸ªno-timestampæ¨¡å¼åŠŸèƒ½
- **é£é™©è¯„ä¼°**: å¯èƒ½éœ€è¦é‡æ–°è®¾è®¡é‡‡æ ·ç­–ç•¥

---

## **ğŸ’¡ æœŸæœ›çš„ä¸“å®¶æŒ‡å¯¼**

1. **æ˜ç¡®no-timestampæ¨¡å¼çš„æ­£ç¡®è¡Œä¸ºæ¨¡å¼**
2. **æä¾›æŠ€æœ¯æ–¹æ¡ˆæˆ–ä¿®å¤æ–¹å‘**
3. **éªŒè¯å½“å‰å®ç°çš„æ¶æ„åˆç†æ€§**
4. **æŒ‡å¯¼è°ƒè¯•å’ŒéªŒè¯çš„æœ€ä½³å®è·µ**

---

**è”ç³»æ–¹å¼**: é€šè¿‡æ–‡æ¡£åé¦ˆè¿›è¡Œå¼‚æ­¥åä½œ  
**ç´§æ€¥ç¨‹åº¦**: ğŸ”´ é«˜ - è¯·ä¼˜å…ˆå¤„ç†
